<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--访问该页面时,在此处生成CSRF令牌.-->
    <!--	<meta name="_csrf" th:content="${_csrf.token}">-->
    <!--	<meta name="_csrf_header" th:content="${_csrf.headerName}">-->

    <th:block th:fragment="css">
        <link rel="icon" href="https://pyyf.oss-cn-hangzhou.aremembermeliyuncs.com/community/icons/cloud.png"/>
        <!--        animate semantic 和 me的顺序最好不要动，这里如果动了似乎有些问题-->
        <link rel="stylesheet"
              href="https://cdn.jsdelivr.net/gh/Gepeng18/communityCDN@v0.1.8/lib/animate.css-3.5.2/animate.css"
              crossorigin="anonymous" type="text/css"/>
        <link rel="stylesheet"
              href="https://cdn.jsdelivr.net/gh/Gepeng18/communityCDN@v0.1.8/lib/Semantic-UI-2.2.4/dist/semantic.min.css"
              crossorigin="anonymous" type="text/css"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Gepeng18/communityCDN@v0.1.8/blog/css/me.css"
              type="text/css" crossorigin="anonymous"/>
        <link rel="stylesheet"
              href="https://cdn.jsdelivr.net/gh/Gepeng18/communityCDN@v0.1.8/lib/bootstrap-4.4.1-dist/css/bootstrap.min.css"
              crossorigin="anonymous" type="text/css"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Gepeng18/communityCDN@v0.1.8/community/css/global.css"
              type="text/css" crossorigin="anonymous"/>
        <link href="https://cdn.jsdelivr.net/gh/Gepeng18/communityCDN@v0.1.8/lib/font-awesome-4.7.0/css/font-awesome.min.css"
              rel="stylesheet">
        <link rel="stylesheet"
              href="https://cdn.jsdelivr.net/gh/Gepeng18/communityCDN@v0.1.8/community/css/my-animate.css"
              crossorigin="anonymous" type="text/css"/>
        <style>
            body {
                /*背景图片*/
                background-image: url("https://pyyf.oss-cn-hangzhou.aliyuncs.com/community/img/email-pattern.png");
            }

            .container, .container-lg, .container-md, .container-sm, .container-xl {
                max-width: 1440px;
            }
        </style>
    </th:block>
    <title>鹏方-首页</title>
</head>
<body>


<th:block th:fragment="header(n)">
    <!--    内容太多，container放不下了，于是增加width,并且太靠边了，于是距离左边100px-->
    <div class="container" style="width:87%;">
        <!-- 导航 -->
        <nav class="navbar navbar-expand-sm navbar-dark">
            <!-- logo -->
            <a class="navbar-brand" href="#"></a>
            <!-- 功能 -->
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <!-- 搜索 -->
                <div id="search">
                    <form class="form-inline my-2 my-lg-0" method="get" th:action="@{/search}">
                        <input class="form-control mr-sm-2" type="search" aria-label="Search" name="keyword"
                               placeholder="请输入搜索内容" th:value="${keyword}"/>
                        <button class="btn btn-outline-light my-2 my-sm-0" type="submit">GO</button>
                    </form>
                </div>

                <div class="nav_computer" style="margin-left: 2%">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item ml-3 btn-group-vertical">
                            <a class="nav-link" th:classappend="${n==0} ? 'active'" th:href="@{/index}">
                                <i class="fa fa-home"></i>&thinsp;首页
                            </a>
                        </li>

                        <li class="nav-item ml-3 btn-group-vertical">
                            <a class="nav-link" th:classappend="${n==1} ? 'active'"
                               th:href="@{/onlineExecutor}">
                                <img src="https://pyyf.oss-cn-hangzhou.aliyuncs.com/community/icons/java-while.png"
                                     width="20">在线编译
                            </a>
                        </li>

                        <li class="nav-item ml-3 btn-group-vertical">
                            <a class="nav-link" th:classappend="${n==2} ? 'active'" th:href="@{/files}">
                                <i class="fa fa-database"></i>&thinsp;云盘
                            </a>
                        </li>

                        <li class="nav-item ml-3 btn-group-vertical">
                            <a class="nav-link" th:classappend="${n==3} ? 'active'" th:href="@{/blogs}">
                                <i class="fa fa-bookmark"></i>&thinsp;博客
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav_pad" style="margin-left: 2%;display: none;">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item ml-3 btn-group-vertical">
                            <a class="nav-link active" href="/index">
                                <i class="fa fa-home"></i>
                            </a>
                        </li>

                        <li class="nav-item ml-3 btn-group-vertical">
                            <a class="nav-link" href="/onlineExecutor">
                                <img src="https://pyyf.oss-cn-hangzhou.aliyuncs.com/community/icons/java-while.png"
                                     width="20">
                            </a>
                        </li>

                        <li class="nav-item ml-3 btn-group-vertical">
                            <a class="nav-link" href="/shareFiles/show">
                                <i class="fa fa-database"></i>
                            </a>
                        </li>

                        <li class="nav-item ml-3 btn-group-vertical">
                            <a class="nav-link" href="/blogs">
                                <i class="fa fa-bookmark"></i>
                            </a>
                        </li>
                    </ul>
                </div>

                <div id="phonerightmenu" style="display: none">
                    <div th:if="${loginUser}!=null" style="margin-top:3px">
                        <ul class="navbar-nav mr-auto">
                            <li class="nav-item ml-3 btn-group-vertical">
                                <a class="nav-link" href="#" th:href="@{/discuss}">
                                    <i class="fa fa-send-o"></i>&thinsp;发布
                                </a>
                            </li>
                        </ul>
                    </div>

                    <div th:if="${loginUser}==null" style="margin-top:3px">
                        <button class="btn btn-secondary my-2 my-sm-0" type="button" onclick="clickLogin()">登录</button>
                    </div>

                    <div th:if="${loginUser!=null}">
                        <ul class="navbar-nav mr-auto">
                            <li class="nav-item ml-3 btn-group-vertical dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                                   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <img th:src="${loginUser.headerUrl}" class="rounded-circle" style="width:30px;"/>
                                </a>
                                <div class="dropdown-menu" aria-labelledby="navbarDropdown" style="margin-left:-40px">
                                    <a class="dropdown-item text-center" th:href="@{/user}">
                                        账号设置
                                    </a>
                                    <a class="dropdown-item text-center"
                                       th:href="@{|/user/${loginUser.id}|}">
                                        个人主页
                                    </a>
                                    <a class="dropdown-item text-center" th:href="@{/admin/blog/blogs}">
                                        博客管理
                                    </a>
                                    <a class="dropdown-item text-center" th:href="@{/letters}"
                                       style="padding-left: 0px;padding-right: 0px">
                                        消息
                                        <span class="badge badge-danger" style="position: inherit;padding-left: 5px"
                                              th:text="${allUnreadCount!=0?allUnreadCount:''}">12</span>
                                    </a>
                                    <a class="dropdown-item text-center" href="#" onclick="logout()">
                                        退出登录
                                    </a>

                                    <div class="dropdown-divider"></div>
                                    <span class="dropdown-item text-center text-secondary"
                                          th:utext="${loginUser.username}">鹏圆云方</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>

            </div>
            <div id="rightmenu" style="float: right">
                <div th:if="${loginUser}!=null" style="float:left;margin-top:3px">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item ml-3 btn-group-vertical">
                            <a class="nav-link" href="#" th:href="@{/discuss}">
                                <i class="fa fa-send-o"></i>&thinsp;发布
                            </a>
                        </li>
                    </ul>
                </div>

                <div th:if="${loginUser}==null" style="float:right;margin-top:3px">
                    <button class="btn btn-secondary my-2 my-sm-0" type="button" onclick="clickLogin()">登录</button>
                </div>

                <div th:if="${loginUser!=null}" style="float:right;">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item ml-3 btn-group-vertical dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                               data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img th:src="${loginUser.headerUrl}" class="rounded-circle" style="width:30px;"/>
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown" style="margin-left:-40px">
                                <a class="dropdown-item text-center" th:href="@{/user}">
                                    账号设置
                                </a>
                                <a class="dropdown-item text-center"
                                   th:href="@{|/user/${loginUser.id}|}">
                                    个人主页
                                </a>
                                <a class="dropdown-item text-center" th:href="@{/admin/blog/blogs}">
                                    博客管理
                                </a>
                                <a class="dropdown-item text-center" th:href="@{/letters}"
                                   style="padding-left: 0px;padding-right: 0px">
                                    消息
                                    <span class="badge badge-danger" style="position: inherit;padding-left: 5px"
                                          th:text="${allUnreadCount!=0?allUnreadCount:''}">12</span>
                                </a>
                                <a class="dropdown-item text-center" href="#" onclick="logout()">
                                    退出登录
                                </a>

                                <div class="dropdown-divider"></div>
                                <span class="dropdown-item text-center text-secondary"
                                      th:utext="${loginUser.username}">鹏圆云方</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <button class="navbar-toggler" type="button" data-toggle="collapse"
                    data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </nav>
    </div>
    <!--    一些标志位-->
    <span id="hasLogin" style="display:none" th:text="${hasLogin}"></span>
</th:block>
<!-- 分页 -->
<nav class="mt-5" th:if="${page.rows>0}" th:fragment="pagination">
    <ul class="pagination justify-content-center">
        <li class="page-item">
            <a class="page-link" th:href="@{${page.path}(current=1)}">首页</a>
        </li>
        <li th:class="|page-item ${page.current==1?'disabled':''}|">
            <a class="page-link" th:href="@{${page.path}(current=${page.current-1})}">上一页</a></li>
        <li th:class="|page-item ${i==page.current?'active':''}|"
            th:each="i:${#numbers.sequence(page.from,page.to)}">
            <a class="page-link" th:href="@{${page.path}(current=${i})}" th:text="${i}">1</a>
        </li>
        <li th:class="|page-item ${page.current==page.total?'disabled':''}|">
            <a class="page-link" th:href="@{${page.path}(current=${page.current+1})}">下一页</a>
        </li>
        <li class="page-item">
            <a class="page-link" th:href="@{${page.path}(current=${page.total})}">末页</a>
        </li>
    </ul>
</nav>

<!--底部footer-->
<footer th:fragment="footer" class="ui inverted vertical segment m-padded-tb-massive">
    <div class="ui center aligned container">
        <div class="ui inverted divided stackable grid">
            <div class="three wide column">
                <div class="ui inverted link list">
                    <div class="item">
                        <img src="http://pyyf.oss-cn-hangzhou.aliyuncs.com/community/img/wechat.jpg"
                             class="ui rounded image" alt="" style="width: 110px">
                    </div>
                </div>
            </div>
            <div class="three wide column">
                <h4 class="ui inverted header m-text-thin m-text-spaced ">推荐博客</h4>
                <div id="recBlogs-container">
                    <div class="ui inverted link list" th:fragment="recBlogsList">
                        <a th:href="@{/blog/{id}(id=${blog.id})}" target="_blank" class="item m-text-thin"
                           th:each="blog : ${recBlogs}" th:text="${blog.title}">
                        </a>
                    </div>
                </div>
            </div>
            <div class="three wide column">
                <h4 class="ui inverted header m-text-thin m-text-spaced ">联系我</h4>
                <div class="ui inverted link list">
                    <a href="#" class="item m-text-thin">Email：robin_ge@foxmail.com </a>
                    <a href="#" class="item m-text-thin">QQ：1146816379</a>
                </div>
            </div>
            <div class="seven wide column">
                <h4 class="ui inverted header m-text-thin m-text-spaced ">鹏圆云方社区</h4>
                <p class="m-text-thin m-text-spaced m-opacity-mini">鹏圆云方致力于帮助解决编程中遇到的所有问题，希望可以给来到这儿的人有所帮助...</p>
            </div>
        </div>
        <div class="ui inverted section divider"></div>
        <p class="m-text-thin m-text-spaced m-opacity-tiny">Copyright © 2020 - <span
                th:text="${#dates.year(#dates.createNow())}"></span>
            备案号:<a class="text-white-50" href="http://www.beian.miit.gov.cn/">皖ICP备19020805号-1</a>
        </p>
    </div>

</footer>

<th:block th:fragment="registerAndLoginMenu">
    <!--    使用js触发这个按钮，弹出框-->
    <button type="button" id="loginButton" style="display:none;" data-toggle="modal" data-target="#loginModal">我要发布
    </button>
    <!-- 弹出框 -->
    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog"
         aria-labelledby="publishModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <!-- 内容 -->
                <div class="pr-5 pt-3 pb-3 mt-3 mb-3">
                    <h3 class="text-center text-info border-bottom pb-3">登&nbsp;&nbsp;录</h3>
                    <div class="form-group row">
                        <label for="loginUsername" class="col-sm-2 col-form-label text-right">账号:</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control "
                                   id="loginUsername" name="username" placeholder="请输入您的账号!" required>
                            <div id="loginUsernameMsg" class="invalid-feedback">
                                该账号不存在!
                            </div>
                        </div>
                    </div>
                    <div class="form-group row mt-4">
                        <label for="loginPassword" class="col-sm-2 col-form-label text-right">密码:</label>
                        <div class="col-sm-10">
                            <input type="password" class="form-control"
                                   id="loginPassword" name="password" placeholder="请输入您的密码!" required>
                            <div id="loginPasswordMsg" class="invalid-feedback">
                                密码长度不能小于8位!
                            </div>
                        </div>
                    </div>
                    <div class="form-group row mt-4">
                        <label for="loginVerifycode" class="col-sm-2 col-form-label text-right">验证码:</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control "
                                   id="loginVerifycode" name="verifycode" placeholder="请输入验证码!">
                            <div id="loginVerifycodeMsg" class="invalid-feedback">
                                验证码不正确!
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <img th:src="@{/kaptcha}" id="kaptcha" style="width:100px;height:40px;" class="mr-2"/>
                            <a href="javascript:refresh_kaptcha();" class="font-size-12 align-bottom">刷新验证码</a>
                        </div>
                    </div>
                    <div class="form-group row mt-4">
                        <div class="col-sm-2"></div>
                        <div class="col-sm-10">
                            <input type="checkbox" id="loginRemember-me" name="loginRemember-me">
                            <label class="form-check-label" for="loginRemember-me">记住我</label>
                            <a th:href="@{/user/forget}" class="text-danger float-right">忘记密码?</a>
                        </div>
                    </div>
                    <div class="form-group row mt-4">
                        <div class="col-sm-2"></div>
                        <div class="col-sm-10 text-center">
                            <button onclick="doLogin()" class="btn btn-info text-white form-control">立即登录</button>
                        </div>
                    </div>
                    <div class="form-group row mt-4">
                        <div class="col-sm-2"></div>
                        <div class="col-sm-10">
                            <span>其他方式：</span>
                            <a href="#" th:href="@{/tencentqqLogin}"><img
                                    src="https://pyyf.oss-cn-hangzhou.aliyuncs.com/community/icons/qq.png"
                                    style="width: 30px"></a>
                            <a th:href="@{https://github.com/login/oauth/authorize(client_id='2cd02217dd8c900ebffb',scope='user',state=1)}"
                               style="margin-left: 10px;">
                                <img src="https://pyyf.oss-cn-hangzhou.aliyuncs.com/community/icons/github.png"
                                     style="width: 28px">
                            </a>
                            <span style="margin-left: 20px"> 不推荐使用github登录，容易失败</span>
                            <a href="#" onclick="clickRegister()" style="float: right;color:teal">立即注册</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!--    使用js触发这个按钮，弹出框-->
    <button type="button" id="registerButton" style="display:none;" data-toggle="modal" data-target="#registerModal">
        我要发布
    </button>

    <!-- 弹出框 -->
    <div class="modal fade" id="registerModal" tabindex="-1" role="dialog"
         aria-labelledby="publishModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="pr-5 pt-3 pb-3 mt-3 mb-3">
                    <h3 class="text-center text-info border-bottom pb-3">注&nbsp;&nbsp;册</h3>
                    <div class="form-group row">
                        <label for="registerUsername" class="col-sm-2 col-form-label text-right">账号:</label>
                        <div class="col-sm-10">
                            <input type="text"
                                   class="form-control"
                                   id="registerUsername" name="username" placeholder="请输入您的账号!" required>
                            <div id="registerUsernameMsg" class="invalid-feedback">
                                该账号已存在!
                            </div>
                        </div>
                    </div>
                    <div class="form-group row mt-4">
                        <label for="registerPassword" class="col-sm-2 col-form-label text-right">密码:</label>
                        <div class="col-sm-10">
                            <input type="password"
                                   class="form-control"
                                   id="registerPassword" name="password" placeholder="请输入您的密码!" required>
                            <div id="registerPasswordMsg" class="invalid-feedback">
                                密码长度不能小于8位!
                            </div>
                        </div>
                    </div>
                    <div class="form-group row mt-4">
                        <label for="registerConfirm-Password" class="col-sm-2 col-form-label text-right">确认密码:</label>
                        <div class="col-sm-10">
                            <input type="password" class="form-control"
                                   id="registerConfirm-Password" placeholder="请再次输入密码!" required>
                            <div id="registerConfirm-PasswordMsg" class="invalid-feedback">
                                两次输入的密码不一致!
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="registerEmail" class="col-sm-2 col-form-label text-right">邮箱:</label>
                        <div class="col-sm-10">
                            <input type="email"
                                   class="form-control"
                                   id="registerEmail" name="email" placeholder="请输入您的邮箱!" required>
                            <div id="registerEmailMsg" class="invalid-feedback">
                                该邮箱已注册!
                            </div>
                        </div>
                    </div>
                    <div class="form-group row mt-4">
                        <div class="col-sm-2"></div>
                        <div class="col-sm-10 text-center">
                            <button onclick="doRegister()" class="btn btn-info text-white form-control">立即注册</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 提示框 -->
    <div class="modal fade" id="hintModal" tabindex="-1" role="dialog" aria-labelledby="hintModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="hintModalLabel">提示</h5>
                </div>
                <div class="modal-body" id="hintBody">
                    发布完毕!
                </div>
            </div>
        </div>
    </div>

    <!-- 提示框 -->
    <div class="modal fade" id="registerResultModal" tabindex="-1" role="dialog" aria-labelledby="hintModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="jumbotron" style="background-color:white">
                    <p class="lead">注册成功,我们已经向您的邮箱发送了一封激活邮件,请尽快激活!</p>
                    <hr class="my-4">
                    <p>
                        系统会在 <span id="seconds" class="text-danger">30</span> 秒后自动跳转至登录界面
                        您也可以点此 <a id="target" href="#" onclick="clickLogin()" class="text-primary">链接</a>, 手动跳转!

                    </p>
                    <hr class="my-4">
                    <p>
                        如您未收到邮件提醒，请检查您的邮箱是否将此邮件识别为垃圾邮件而放置在垃圾箱中，
                        如识别为垃圾邮件请将邮件移出垃圾箱，并前往您的邮箱系统将 community@pyyf.site 设置为白名单。
                        (PS. 论坛承诺不会给您发送垃圾邮件以及广告，请放心设置)
                    </p>
                </div>
            </div>
        </div>
    </div>

</th:block>

<th:block th:fragment="daohang">
    <div class="col-xs-3 col-md-2 ">
        <div class="list-group category_div_middle" style="width:80px;position:fixed;margin-top:50px;margin-left:30px">

            <a th:href="@{/index(orderMode=${orderMode},categoryId=-1)}"
               th:class="|list-group-item ${-1==currentCategory?'active':''}|"
               style="padding-left:0;padding-right:0;text-align:center">
                <span class="blogsListAni animated">全部</span>
            </a>

            <a th:href="@{/index(orderMode=${orderMode},categoryId=${category.id})}"
               th:class="|list-group-item ${category.id==currentCategory?'active':''}|"
               th:each="category:${categorys}"
               style="padding-left:0;padding-right:0;text-align:center">
                <span class="blogsListAni animated" th:text="${category.name}"></span>
            </a>
        </div>
    </div>
</th:block>

<th:block th:fragment="script">
    <script src="https://cdn.jsdelivr.net/gh/Gepeng18/communityCDN@v0.1.8/lib/jquery.min.js-3.2.1/jquery.min.js"
            crossorigin="anonymous"
            type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/gh/Gepeng18/communityCDN@v0.1.8/lib/popper.js" crossorigin="anonymous"
            type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/gh/Gepeng18/communityCDN@v0.1.8/lib/bootstrap-4.4.1-dist/js/bootstrap.min.js"
            crossorigin="anonymous" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/gh/Gepeng18/communityCDN@v0.1.8/community/js/global.js"
            crossorigin="anonymous" type="text/javascript"></script>
    <script>
        $('#recBlogs-container').load("/footer/recBlogs");

        function clickLogin() {
            $('#registerResultModal').modal("hide");
            document.getElementById('loginButton').click()
        }

        function doLogin() {
            var data = {
                username: $('#loginUsername').val(),
                password: $('#loginPassword').val(),
                verifycode: $('#loginVerifycode').val(),
                rememberme: $("input[name='loginRemember-me']").prop("checked")
            };

            $.post(
                "/login",
                data,
                function (data) {
                    data = $.parseJSON(data);
                    console.log(data);
                    if (data.code == 0) {
                        $('#loginModal').modal("hide");
                        // 在提示框中显示返回消息
                        $("#hintBody").text(data.msg);
                        // 显示提示框
                        $("#hintModal").modal("show");
                        // 2秒后,自动隐藏提示框
                        setTimeout(function () {
                            $("#hintModal").modal("hide");
                            // 刷新页面
                            if (data.code == 0) {
                                window.location.reload();
                            }
                        }, 1500);

                    } else {
                        if (data.usernameMsg != null) {
                            $('#loginUsername').addClass("is-invalid");
                            $('#loginUsernameMsg').html(data.usernameMsg);
                        }
                        if (data.passwordMsg != null) {
                            $('#loginPassword').addClass("is-invalid");
                            $('#loginPasswordMsg').html(data.passwordMsg);
                        }
                        if (data.verifyCodeMsg != null) {
                            $('#loginVerifycode').addClass("is-invalid");
                            $('#loginVerifycodeMsg').html(data.verifyCodeMsg);
                        }


                    }
                }
            );
        }

        $("#loginUsername").bind('input propertychange', function () {
            if ($('#loginUsername').hasClass("is-invalid")) {
                $('#loginUsername').removeClass("is-invalid");
                $('#loginUsernameMsg').html("");
            }

        });

        $("#loginPassword").bind('input propertychange', function () {
            if ($('#loginPassword').hasClass("is-invalid")) {
                $('#loginPassword').removeClass("is-invalid");
                $('#loginPasswordMsg').html("");
            }

        });

        $("#loginVerifycode").bind('input propertychange', function () {
            if ($('#loginVerifycode').hasClass("is-invalid")) {
                $('#loginVerifycode').removeClass("is-invalid");
                $('#loginVerifycodeMsg').html("");
            }
        });


        function clickRegister() {
            $('#loginModal').modal("hide");
            document.getElementById('registerButton').click()
        }

        function doRegister() {
            let success = check_data();
            if (!success)
                return;
            var data = {
                username: $('#registerUsername').val(),
                password: $('#registerPassword').val(),
                confirmPassword: $('#registerConfirm-Password').val(),
                email: $('#registerEmail').val()
            };

            $.post(
                "/register",
                data,
                function (data) {
                    data = $.parseJSON(data);
                    if (data.code == 0) {
                        $('#registerModal').modal("hide");
                        $("#registerResultModal").modal("show");
                        let interval = setInterval(function () {
                            var seconds = $("#seconds").text();
                            $("#seconds").text(--seconds);
                            if (seconds == 0) {
                                $('#registerResultModal').modal("hide");
                                if ($('#loginModal').css('display') == "none")
                                    document.getElementById('loginButton').click();
                                clearInterval(interval);
                                $("#seconds").text(30);
                            }

                        }, 1000);

                    } else {
                        if (data.usernameMsg != null) {
                            $('#registerUsername').addClass("is-invalid");
                            $('#registerUsernameMsg').html(data.usernameMsg);
                        }
                        if (data.passwordMsg != null) {
                            $('#registerPassword').addClass("is-invalid");
                            $('#registerPasswordMsg').html(data.passwordMsg);
                        }
                        if (data.emailMsg != null) {
                            $('#registerEmail').addClass("is-invalid");
                            $('#registerEmailMsg').html(data.emailMsg);
                        }


                    }
                }
            );
        }

        $("#registerUsername").bind('input propertychange', function () {
            if ($('#registerUsername').hasClass("is-invalid")) {
                $('#registerUsername').removeClass("is-invalid");
                $('#registerUsernameMsg').html("");
            }

        });

        $("#registerPassword").bind('input propertychange', function () {
            if ($('#registerPassword').hasClass("is-invalid")) {
                $('#registerPassword').removeClass("is-invalid");
                $('#registerPasswordMsg').html("");
            }

        });

        $("#registerEmail").bind('input propertychange', function () {
            if ($('#registerEmail').hasClass("is-invalid")) {
                $('#registerEmail').removeClass("is-invalid");
                $('#registerEmailMsg').html("");
            }

        });

        $("#registerConfirm-Password").bind('input propertychange', function () {
            if ($('#registerConfirm-Password').hasClass("is-invalid")) {
                $('#registerConfirm-Password').removeClass("is-invalid");
                $('#registerConfirm-PasswordMsg').html("");
            }
        });

        function check_data() {
            var pwd1 = $("#registerPassword").val();
            var pwd2 = $("#registerConfirm-Password").val();
            if (pwd1 != pwd2) {
                $("#registerConfirm-Password").addClass("is-invalid");
                $("#registerConfirm-PasswordMsg").html("两次输入的密码不一致!");
                return false;
            }
            return true;
        }

        function refresh_kaptcha() {
            var path = CONTEXT_PATH + "/kaptcha?p=" + Math.random();
            $("#kaptcha").attr("src", path);
        }

        function logout() {
            $.get(
                "/logout",
                function (data) {
                    data = $.parseJSON(data);
                    if (data.code == 0) {
                        $("#hintBody").text(data.msg);
                        // 显示提示框
                        $("#hintModal").modal("show");
                        // 2秒后,自动隐藏提示框
                        setTimeout(function () {
                            $("#hintModal").modal("hide");
                            // 刷新页面
                            if (data.code == 0) {
                                window.location.href="/";
                            }
                        }, 1500);
                    }
                }
            );

        }
    </script>


    <script>
        $(function () {
            $(window).on('resize', function () {
                //console.log("宽度改变了!");
                //console.log($(window).width());
                adapter_size_show();
            }).resize();
            // window.onresize=function(){
            //     //console.log("宽度改变了!");
            //     adapter_size_show();
            // }
        });

        function adapter_size_show() {
            if ($(window).width() >= 870) {
                console.log(">870");
                $('.nav_computer').css("display", "");
                $('.nav_pad').css("display", "none");
                $('.phonerightmenu').css("display", "none");
                $('#search').css("display", "");
                $('#sitebar').css("display", "");
                $('#rightmenu').css("display", "");
                $('#waypoint').css("margin-top", "30px");
                $('#waypoint').css("margin-bottom", "30px");
                $('#waypoint').css("margin-left", "80px");
                $('#waypoint').css("margin-right", "80px");

            } else if ($(window).width() >= 680) {
                console.log("680 - 870");
                $('.nav_computer').css("display", "none");
                $('.nav_pad').css("display", "");
                $('.phonerightmenu').css("display", "none");
                $('#search').css("display", "");
                $('#sitebar').css("display", "");
                $('#rightmenu').css("display", "");
                $('#waypoint').css("margin-top", "30px");
                $('#waypoint').css("margin-bottom", "30px");
                $('#waypoint').css("margin-left", "45px");
                $('#waypoint').css("margin-right", "45px");
            } else if ($(window).width() >= 560) {
                console.log("560 - 680");
                $('.phonerightmenu').css("display", "none");
                $('#rightmenu').css("display", "");
                $('#search').css("display", "none");
                $('#sitebar').css("display", "none");
                $('.nav_computer').css("display", "none");
                $('.nav_pad').css("display", "");
                $('#waypoint').css("margin-top", "30px");
                $('#waypoint').css("margin-bottom", "30px");
                $('#waypoint').css("margin-left", "30px");
                $('#waypoint').css("margin-right", "30px");
            } else {
                console.log("小于");
                $('.phonerightmenu').css("display", "");
                $('#rightmenu').css("display", "none");
                $('#search').css("display", "");
                $('#sitebar').css("display", "none");
                $('.nav_computer').css("display", "");
                $('.nav_pad').css("display", "none");
                $('#waypoint').css("margin-left", "0px");
                $('#waypoint').css("margin-right", "0px");
                $('#waypoint').css("margin-top", "0px");
                $('#waypoint').css("margin-bottom", "0px");
            }
        }
    </script>
    <script>
        var selfLogin = false;
        var follow = $('#profile_block').find('#p_b_follow');
        var block = follow.length >= 1 ? follow[0] : "";
        var followText = (block != null && block != undefined) ? block.innerHTML : "";
        if(followText == "") selfLogin = true;
        var pageInfo = ""
        if ($('#hasLogin').text() == "0") {
            pageInfo = '\r\n\r\n---------------------\r\n来源：鹏圆云方论坛(wd.pyyf.site)\r\n'
                + '链接：' + document.location.href
                + '\r\n如果您觉得本站对您有帮助，请将本站推荐给您的小伙伴们，谢谢啦!';
        }
        document.addEventListener('copy', function (ev) {
            var targetHTML = $.trim($(ev.target).html());
            // console.log("targetHTML:" + targetHTML)
            if (targetHTML == "") return;
            if (!(targetHTML.startsWith('<table class="hljs-ln"') && targetHTML.endsWith('</table>')) || !selfLogin)  // isLogined
            {
                var selected = window.getSelection();
                var selectedText = selected.toString();
                let copyRightStr = (selectedText + pageInfo).replace(/\n/g, '\r\n'); // Solve the line breaks conversion issue

                ev.clipboardData.setData('text/plain', `${copyRightStr}`);
                ev.preventDefault();
            }
        });

            //
            // if ($('#hasLogin').text() == "0") {
            //     var copyFooter = '<br><br>---------------------<br>来源：鹏圆云方论坛(wd.pyyf.site)<br>'
            //         + '链接：' + document.location.href + '<br>'
            //         + '如果您觉得本站对您有帮助，请将本站推荐给您的小伙伴们，谢谢啦!';
            //     var copyHolder = $('<div>', {
            //         id: 'temp',
            //         html: selectedText + copyFooter,
            //         style: {position: 'absolute', left: '-99999px'}
            //     });
            // } else {
            //     var copyHolder = $('<div>', {
            //         id: 'temp',
            //         html: selectedText,
            //         style: {position: 'absolute', left: '-99999px'}
            //     });
            // }

    </script>
</th:block>

</body>
</html>
